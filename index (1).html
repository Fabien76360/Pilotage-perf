<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Performance Lignes - Dashboard Atelier</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="brand-block">
        <span class="brand-mark">PRS</span>
        <div>
          <h1>Performance Lignes</h1>
          <p>Tableau de bord 3x8 - Inspiration SMED V05</p>
        </div>
      </div>
      <div class="session-meta" aria-live="polite" id="session-meta"></div>
      <div class="header-actions">
        <button class="round-btn" id="new-session">Nouvelle session</button>
        <button class="round-btn accent" id="export-report-html">Exporter Rapport HTML</button>
        <button class="round-btn outline" id="export-journal-csv">Journal CSV</button>
      </div>
    </header>

    <main>
      <nav class="tab-bar" aria-label="Navigation principale">
        <button class="tab-button active" data-target="production" role="tab" aria-selected="true">Production</button>
        <button class="tab-button" data-target="analysis" role="tab" aria-selected="false">Analyse</button>
        <button class="tab-button" data-target="settings" role="tab" aria-selected="false">Paramètres</button>
      </nav>

      <section id="production" class="tab-panel active" role="tabpanel">
        <div class="panel-grid">
          <section class="card session-card" aria-labelledby="session-title">
            <header class="card-header" id="session-title">
              <h2>Session de production</h2>
              <p>Sélectionner la ligne, l'ordre et la date à suivre.</p>
            </header>
            <form id="session-form" class="session-form">
              <div class="form-row">
                <label for="session-line">Ligne</label>
                <select id="session-line" name="line" required></select>
              </div>
              <div class="form-row">
                <label for="session-order">Ordre de Production</label>
                <input type="text" id="session-order" name="order" placeholder="OF-2024-001" />
              </div>
              <div class="form-row">
                <label for="session-date">Date</label>
                <input type="date" id="session-date" name="date" required />
              </div>
              <div class="form-row">
                <label for="session-cycle">Temps cycle (min)</label>
                <input type="number" step="0.01" id="session-cycle" name="cycle" />
              </div>
              <div class="form-row">
                <label for="session-target">Cadence cible (u/h)</label>
                <input type="number" step="1" id="session-target" name="target" />
              </div>
              <div class="form-actions">
                <button type="button" class="round-btn" id="save-session">Enregistrer</button>
              </div>
            </form>
          </section>

          <section class="card" aria-labelledby="hourly-title">
            <header class="card-header" id="hourly-title">
              <h2>Saisie horaire par équipe</h2>
              <p>Quantités bonnes et rebuts sur 24h (3×8).</p>
            </header>
            <div class="table-wrapper">
              <table id="hourly-table" class="data-table">
                <thead>
                  <tr>
                    <th>Heure</th>
                    <th>Équipe</th>
                    <th>Bon</th>
                    <th>Rebut</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>

          <section class="card timeline-card" aria-labelledby="timeline-title">
            <header class="card-header" id="timeline-title">
              <div>
                <h2>Timeline 10 min</h2>
                <p>Cliquer sur une tranche pour noter « run » ou « événement ».</p>
              </div>
              <button class="round-btn outline" id="event-shortcut">Évènement</button>
            </header>
            <div class="timeline-grid" id="timeline-grid" aria-describedby="timeline-title"></div>
            <div class="timeline-legend">
              <span><span class="dot run"></span>Run</span>
              <span><span class="dot event"></span>Évènement</span>
            </div>
          </section>

          <section class="card" aria-labelledby="journal-title">
            <header class="card-header" id="journal-title">
              <h2>Journal Chronologique</h2>
              <p>Historique des productions et évènements.</p>
            </header>
            <div class="table-wrapper">
              <table id="journal-table" class="data-table">
                <thead>
                  <tr>
                    <th>Horodatage</th>
                    <th>Type</th>
                    <th>Détails</th>
                    <th>Commentaire</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>
        </div>
      </section>

      <section id="analysis" class="tab-panel" role="tabpanel" hidden>
        <div class="panel-grid">
          <section class="card" aria-labelledby="kpi-title">
            <header class="card-header" id="kpi-title">
              <h2>KPI TRS</h2>
              <p>Mesures consolidées pour la session sélectionnée.</p>
            </header>
            <div class="kpi-grid" id="kpi-grid">
              <article class="kpi-card" data-kpi="trs">
                <h3>TRS</h3>
                <p class="value">0%</p>
                <p class="hint">(QTÉ bonne × temps cycle) ÷ temps ouvert</p>
              </article>
              <article class="kpi-card" data-kpi="availability">
                <h3>Disponibilité</h3>
                <p class="value">0%</p>
              </article>
              <article class="kpi-card" data-kpi="performance">
                <h3>Performance</h3>
                <p class="value">0%</p>
              </article>
              <article class="kpi-card" data-kpi="quality">
                <h3>Qualité</h3>
                <p class="value">0%</p>
              </article>
            </div>
          </section>

          <section class="card" aria-labelledby="chart-hourly-title">
            <header class="card-header" id="chart-hourly-title">
              <h2>Production vs Cible</h2>
              <p>Comparatif horaire.</p>
            </header>
            <canvas id="chart-hourly" width="900" height="300" role="img" aria-label="Production vs cible par heure"></canvas>
          </section>

          <section class="card" aria-labelledby="chart-team-title">
            <header class="card-header" id="chart-team-title">
              <h2>Production par équipe</h2>
              <p>Répartition 3×8.</p>
            </header>
            <canvas id="chart-team" width="900" height="260" role="img" aria-label="Production par équipe"></canvas>
          </section>

          <section class="card" aria-labelledby="losses-title">
            <header class="card-header" id="losses-title">
              <h2>Top pertes &amp; causes</h2>
            </header>
            <div class="losses-grid">
              <div>
                <h3>Top 3 pertes</h3>
                <ol id="top-losses"></ol>
              </div>
              <div>
                <h3>Causes récurrentes</h3>
                <ul id="recurring-causes"></ul>
              </div>
            </div>
          </section>

          <section class="card" aria-labelledby="history-title">
            <header class="card-header" id="history-title">
              <h2>Historique sessions</h2>
            </header>
            <div class="table-wrapper">
              <table id="history-table" class="data-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Ligne</th>
                    <th>OF</th>
                    <th>TRS</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>
        </div>
      </section>

      <section id="settings" class="tab-panel" role="tabpanel" hidden>
        <div class="panel-grid">
          <section class="card" aria-labelledby="lines-title">
            <header class="card-header" id="lines-title">
              <h2>Lignes</h2>
              <button class="round-btn" id="add-line">Ajouter ligne</button>
            </header>
            <div class="table-wrapper">
              <table id="lines-table" class="data-table">
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th>Cadence (u/h)</th>
                    <th>Temps cycle (min)</th>
                    <th>Seuil TRS</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>

          <section class="card" aria-labelledby="teams-title">
            <header class="card-header" id="teams-title">
              <h2>Équipes 3×8</h2>
              <button class="round-btn" id="add-team">Ajouter équipe</button>
            </header>
            <div class="table-wrapper">
              <table id="teams-table" class="data-table">
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th>Début poste</th>
                    <th>Couleur</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>

          <section class="card" aria-labelledby="events-title">
            <header class="card-header" id="events-title">
              <h2>Événements standard</h2>
              <button class="round-btn" id="add-event">Ajouter événement</button>
            </header>
            <div class="table-wrapper">
              <table id="events-table" class="data-table">
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th>Catégorie</th>
                    <th>Sous-catégorie</th>
                    <th>Couleur</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>

          <section class="card" aria-labelledby="reset-title">
            <header class="card-header" id="reset-title">
              <h2>Maintenance des données</h2>
            </header>
            <div class="reset-block">
              <p>Réinitialiser l'ensemble des données locales.</p>
              <button class="round-btn warn" id="reset-state">Reset localStorage</button>
            </div>
          </section>
        </div>
      </section>
    </main>

    <div class="toast-container" role="status" aria-live="polite" aria-atomic="true"></div>

    <dialog id="slot-dialog" aria-labelledby="slot-dialog-title">
      <form method="dialog" id="slot-form">
        <h2 id="slot-dialog-title">Configurer la tranche</h2>
        <p id="slot-time"></p>
        <label for="slot-team">Équipe</label>
        <select id="slot-team"></select>
        <fieldset>
          <legend>Statut</legend>
          <label class="radio">
            <input type="radio" name="slot-status" value="run" checked />
            Run
          </label>
          <label class="radio">
            <input type="radio" name="slot-status" value="event" />
            Évènement
          </label>
        </fieldset>
        <label for="slot-event">Évènement standard</label>
        <select id="slot-event"></select>
        <label for="slot-note">Commentaire</label>
        <textarea id="slot-note" rows="3"></textarea>
        <menu>
          <button value="cancel" class="round-btn outline">Annuler</button>
          <button value="default" class="round-btn accent" id="slot-save">Enregistrer</button>
        </menu>
      </form>
    </dialog>

    <dialog id="confirm-reset" aria-labelledby="confirm-reset-title">
      <form method="dialog">
        <h2 id="confirm-reset-title">Réinitialiser les données ?</h2>
        <p>Cette action efface toutes les sessions et paramètres locaux.</p>
        <menu>
          <button value="cancel" class="round-btn outline">Annuler</button>
          <button value="confirm" class="round-btn warn">Confirmer</button>
        </menu>
      </form>
    </dialog>

    <script type="module" src="app.js"></script>
  </body>
</html>
